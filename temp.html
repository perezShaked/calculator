
let pharse = "";
let pharseArray = [];
let buttons = document.getElementsByTagName("button");
let showBar = document.getElementById("showBar");
let inputBar = document.getElementById("inputBar");

inputBar.addEventListener("input", (event) => {
  checkInputBar();
});

for(let button of buttons){
  button.addEventListener("click", () => {
    if(button.classList.contains("numbersButtons")){
      inputBar.value += ;
    }else if(button.classList.contains("operatorsButtons")){
      operatorCharPressed(button.innerHTML);
    }else if(button.innerHTML == "←"){
      inputBar.value = inputBar.value.slice(0, -1);
    }else if(button.innerHTML == "C"){
      pharse = "";
      showBar.innerHTML = pharse;
      inputBar.value = "";
    }else if(button.innerHTML == "."){
      pointCharPressed();
    }else if (button.innerHTML == "="){
      equalButtonPressed();
    }
  })
}

let checkInputBar = () => {
  if(!isNaN(inputBar.value.at(-1))){
    numberCharPressed(inputBar.value);
  }else if(inputBar.value.at(-1) == "+" || event.target.value.at(-1) == "-" || event.target.value.at(-1) == "*"|| event.target.value.at(-1) == "/"){
    operatorCharPressed(inputBar.value);
  }else if(inputBar.value.at(-1) == "."){
    pointCharPressed();
  }
}

let pointCharPressed = () => {
  if(!(inputBar.value.includes(".")) && inputBar.value.length != 0){
    pharse += ".";
    inputBar.value += ".";
  }
}

let numberCharPressed = (char) => {
  pharse += char;
  inputBar.value += char;
}

let operatorCharPressed = (char) => {
  if(pharse.at(-1) == "."){
    pharse = pharse.slice(0, -1);
  }
  if(pharse.at(-1) == " "){
    pharse = pharse.slice(0, -1);
  }
  if(pharse.at(-1) == "+" || pharse.at(-1) == "-" || pharse.at(-1) == "*"|| pharse.at(-1) == "/"){
    pharse = pharse.slice(0, -1) + char + " ";
  }else if(pharse.length > 0){
    pharse += " " + char + " ";
    inputBar.value = "";
  }
  showBar.innerHTML = pharse; 
}

let equalButtonPressed = () => {
  if(pharse.at(-1) == " "){
    pharse = pharse.slice(0, -1);
  }
  if(isNaN(pharse.at(-1))){
    pharse = pharse.slice(0, -1);
  }
  showBar.innerHTML = pharse;
  inputBar.value = calculatePharse(pharse);
}

let calculatePharse = (pharse) => {
  let methods = {
    "-": (a, b) => a - b,
    "+": (a, b) => a + b,
    "*": (a, b) => a * b,
    "/": (a, b) => a / b,
  };

  let arrayPharse = pharse.split(" ");
  for(let i = 0; i < arrayPharse.length; i++){
    if(arrayPharse[i] == "/" || arrayPharse[i] == "*"){
      arrayPharse[i - 1] = methods[arrayPharse[i]](+arrayPharse[i-1],+arrayPharse[i+1]);
      arrayPharse.splice(i,2);
      i--;
    }
  }
  for(let i = 0; i < arrayPharse.length; i++){
    if(arrayPharse[i] == "-" || arrayPharse[i] == "+"){
      arrayPharse[i - 1] = methods[arrayPharse[i]](+arrayPharse[i-1],+arrayPharse[i+1]);
      arrayPharse.splice(i,2);
      i--;
    }
  }
  if(arrayPharse[0] == Infinity){
    return "Cannot divide by zero";
  }
  return arrayPharse[0].toFixed(2);
}

let deleteLastChar = (pharse) => {
  return(pharse.slice(0, -1));
}


/* inputBar.addEventListener("paste", (event) => {
  event.preventDefault();
  let clipboardData = event.clipboardData.getData('text/plain');
  inputBar.value += clipboardData.replace(/[^\d]/g, "");
  pharse = inputBar.value;
}); */

